<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>预约查询</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/main.css" rel="stylesheet" />
		<link href="../css/activityDetail.css" rel="stylesheet" />
		<style>
			html,body{
				height: inherit;
			}
			.search {
				padding: 15px;
				border-bottom: 1px solid #f5f5f5;
			    background: #fff;	
			    overflow: hidden;
			}
			input[type=text] {
				position: relative;
				width: 100%;
				height: 40px;
				margin: 0;
				padding: 0 0 0 40px; 	
				border: 0;
				border-radius: 6px;
				font-size: 16px;
				color: #000;
				line-height: 45px;
				background: #f5f5f5;
			}
			.mui-input-row.mui-search .mui-icon-clear {
				top: 0;
				width:25px;
				height:40px;
				line-height: 40px;
				background:#f5f5f5;
			}
			.search_icon {
				display: block;
				position: absolute;
				left: 0;
				width: 40px;
				height: 40px;
				background: url('../images/search.png')center center;
				background-size: 90%;
				z-index: 2;
			}
			.searchData{
				margin-top: 10px;
			}

			.item{
				display: block;
				padding: 0 15px;
				background: #fff;
				height: 45px;
				color: #000;
				border-bottom: 1px solid #f5f5f5;
			}
			a:active,a:visited,a:hover,a:link{
				color: #000;
			}
			.itemName,.itemTime{
				line-height: 45px;
			}
			.itemTime{
				float: right;
				color: #B2B2B2;
			}
			.nomore {
				display: none;
				font-size: 18px;
				line-height: 60px;
				text-align: center;
				background: #f9f9f9;	
			}
		</style>
	</head>

	<body style="background-color: #F6F7F8;">
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">预约查询</h1>
		</header>
		<div class="wrap mui-content">
			<div class="search">
				<div class="mui-input-row mui-search">
				    <span class="search_icon"></span>
					<input class="mui-input-clear" name="name" type="text" maxlength="12" placeholder="输入关键词" value="">
				</div>
			</div>
			<div class="searchData">
				<div class="data">
					<a class="item" href="">
						<label class="itemName">个人-陈晨</label>
						<label class="itemTime">2018-12-01</label>
					</a>
					<a class="item" href="">
						<label class="itemName">单位-电力公司</label>
						<label class="itemTime">2018-12-01</label>
					</a>
					<a class="item" href="">
						<label class="itemName">个人-陈晨</label>
						<label class="itemTime">2018-12-01</label>
					</a>
					<a class="item" href="">
						<label class="itemName">单位-电力公司</label>
						<label class="itemTime">2018-12-01</label>
					</a>
					<a class="item" href="">
						<label class="itemName">个人-陈晨</label>
						<label class="itemTime">2018-12-01</label>
					</a>
					<a class="item" href="">
						<label class="itemName">单位-电力公司</label>
						<label class="itemTime">2018-12-01</label>
					</a>
					<a class="item" href="">
						<label class="itemName">个人-陈晨</label>
						<label class="itemTime">2018-12-01</label>
					</a>
					<a class="item" href="">
						<label class="itemName">单位-电力公司</label>
						<label class="itemTime">2018-12-01</label>
					</a>
					<a class="item" href="">
						<label class="itemName">个人-陈晨</label>
						<label class="itemTime">2018-12-01</label>
					</a>
					<a class="item" href="">
						<label class="itemName">单位-电力公司</label>
						<label class="itemTime">2018-12-01</label>
					</a>
					<a class="item" href="">
						<label class="itemName">个人-陈晨</label>
						<label class="itemTime">2018-12-01</label>
					</a>
					<a class="item" href="">
						<label class="itemName">单位-电力公司</label>
						<label class="itemTime">2018-12-01</label>
					</a>
					
					<a class="item" href="">
						<label class="itemName">个人-陈晨</label>
						<label class="itemTime">2018-12-01</label>
					</a>
					<a class="item" href="">
						<label class="itemName">单位-电力公司</label>
						<label class="itemTime">2018-12-01</label>
					</a>
				</div>
				<div class="nomore">没有更多了...</div>
			</div>
		</div>
		<script src="../js/jquery-1.11.0.js"></script>
		<script>
			var pageIndex=1;
			var pageNum=8;
			//回车搜索
			$("input[type='text']").on('keypress', function(e) {
		        var keycode = e.keyCode;
		        if (keycode == '13') {
		            e.preventDefault();
		            console.log($("input[name='name']").val())
		            getData(1);
		        }
		    });
		    //滚动事件
		    window.onscroll=function(){
		    	var clientHeight = $(this).height();
			    var scrollTop = $(this).scrollTop();
			    var scrollHeight = document.body.scrollHeight;
			    if(scrollTop + clientHeight == scrollHeight && scrollTop!=0){
			    	if($('.nomore').is(':hidden')){
			    		pageIndex++;
						getData(pageIndex);
					}
			    }
		    }
			//获取数据
			function getData(pageIndex){
				var name=$("input[name='name']").val();
				console.log(name)
				var data='pageIndex='+pageIndex+'&pageNum='+pageNum+'&name='+name+'';
				$.ajax({
					url:'',
					type:'post',
					data:data,
					success:function(res){
						if(res.status==1){
							console.log(pageIndex);
							//res.data!=null || res.data!='' || res.data!=undefined
							if(pageIndex<2){
								for(var j in res.data){
									html='<a class="item" href="'+res.data[j].url+'">'+
										 '<label class="itemName">'+res.data[j].name+'</label>'+
										 '<label class="itemTime">'+res.data[j].time+'</label></a>'
									$('.searchData .data').append(html);
									html='';
								}
							}else{
								//数据太少，不能显示‘没有更多’
								if(pageIndex>1){
									$('.searchData .data').parent().find('.nomore').show();
								}
							}
						}
					}
				})
			}
		</script>
	</body>

</html>